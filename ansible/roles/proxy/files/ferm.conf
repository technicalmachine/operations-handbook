# ferm basic configuration.

table filter {
    chain INPUT {
        policy DROP;

        # connection tracking
        mod state {
            state INVALID DROP;
            state (RELATED ESTABLISHED) ACCEPT;
        }

        # allow local connections
        interface lo ACCEPT;

        # respond to ping
        proto icmp ACCEPT;

        # allow SSH connections
        proto tcp dport ssh ACCEPT;
    }

    # outgoing connections are not limited
    chain OUTPUT {
        policy ACCEPT;

        # connection tracking
        mod state {
            state INVALID DROP;
            state (RELATED ESTABLISHED) ACCEPT;
        }
    }

    # this is not a router
    chain FORWARD {
        policy DROP;

        # connection tracking
        mod state {
            state INVALID DROP;
            state (RELATED ESTABLISHED) ACCEPT;
        }
    }
}

@include 'ferm.d/';

# - name: Install ferm
#   apt:
#     name=ferm
#     state=present

# - name: Add ferm config directory
#   file:
#     path=/etc/ferm
#     state=directory
#     owner=root group=root mode=0700

# - name: Add ferm config directory for additional config files
#   file:
#     path=/etc/ferm/ferm.d
#     state=directory
#     owner=root group=root mode=0700

# - name: Upload ferm config
#   copy:
#     dest=/etc/ferm/ferm.conf
#     src=/files/ferm.conf
#     owner=root group=root mode=0700
#   notify:
#     - run ferm
